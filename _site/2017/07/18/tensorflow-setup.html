<!doctype html>
<html>
<head>
  <meta charset="utf-8">
<title>tensorflow的安装（ubuntu16.04+cuda8.0+cuDNN6） | 曾颖森wilsonTsang</title>
<meta name="author" content="Wilson Tsang">


  <meta name="description " content="深度学习 tensorflow ubuntu">

<link rel="shortcut icon" href="/public/img/deer3.png" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/public/css/bootstrap.css">
<link rel="stylesheet" href="/public/css/font-awesome.css">
<link rel="stylesheet" href="/public/js/prettify/prettify.css">
<link rel="stylesheet" href="/public/css/base.css">
<link href="/pages/atom.xml" rel="alternate" title="曾颖森wilsonTsang" type="application/atom+xml">
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col-md-3 col-lg-3 col-sm-13 col-xs-13 aside visible-md visible-lg">
  <div class="row">
    <div class="col-md-2 col-xs-2 aside1">
      <br>
      <a class="pjaxlink" href="/"><img src="/public/img/deer3.png" class="img-ronuded avatar" style="border-width:0px; border-color:#000"></a>
      <br><br><br><br>
      <ul class="nav nav-pills nav-stacked">
             <!-- 这里是aside1的读书、生活、科研、技术、绘画-->
         <li><a href="#摄影" data-toggle="tab">摄影</a></li>
             <!-- 这里是aside1的读书、生活、科研、技术、绘画-->
         <li><a href="#心情" data-toggle="tab">心情</a></li>
             <!-- 这里是aside1的读书、生活、科研、技术、绘画-->
         <li><a href="#读书" data-toggle="tab">读书</a></li>
             <!-- 这里是aside1的读书、生活、科研、技术、绘画-->
         <li><a href="#科研" data-toggle="tab">科研</a></li>
        
        <li><a href="#tags" data-toggle="tab">标签</a></li>  
        <li><a class="pjaxlink" href="/pages/archive.html">归档</a></li>
        <li><a class="pjaxlink" href="/pages/about.html">关于</a></li>  
        <!-- <li><a href="#tags" data-toggle="tab"><i class="fa fa-tags fa-lg"></i></a></li>
        <li><a class="pjaxlink" href="/pages/archive.html"><i class="fa fa-archive fa-lg"></i></a></li>
        <li><a class="pjaxlink" href="/pages/about.html"><i class="fa fa-user fa-lg"></i></a></li>
        这是原来现实汉字的代码，我改为了图标 -->
      </ul>
      <div class="aside1_bottom">
        <table class="table table-condensed">
          <tr>
            <td><a href="/pages/atom.xml" target="_blank"><i class="fa fa-rss fa-lg" style="color:#fff;"></i></a></td>
            <td><a href="mailto:yingsen_2@163.com"><i class="fa fa-envelope-o fa-lg" style="color:#fff;"></i></a></td>
          </tr>
        </table>
      </div>
    </div>
    <div class="col-md-10 col-xs-10 aside2">
      <div class="row">
        <div class="tab-content"> 
           
            <div class="tab-pane" id="摄影">
              <div class="list-group">
                <!--<h2 class="center">摄影</h2>-->     <!--原来aside2上面的大标题-->
                
                  <a href="/2017/01/01/go-over-2016.html" class="list-group-item-lay pjaxlink">回顾2016--九张最有意义的照片</a>
                
                  <a href="/2016/08/27/wangjingSOHO.html" class="list-group-item-lay pjaxlink">望京SOHO--第一次爬楼</a>
                
              </div>
            </div>
           
            <div class="tab-pane" id="心情">
              <div class="list-group">
                <!--<h2 class="center">心情</h2>-->     <!--原来aside2上面的大标题-->
                
                  <a href="/2017/01/13/facied-with-adversity.html" class="list-group-item-lay pjaxlink">往抵抗力最大的路径走</a>
                
                  <a href="/2017/01/10/majiang.html" class="list-group-item-lay pjaxlink">麻将之战</a>
                
                  <a href="/2016/10/31/monday-of-xiaozi.html" class="list-group-item-lay pjaxlink">偶尔的小资--星期一</a>
                
              </div>
            </div>
           
            <div class="tab-pane" id="读书">
              <div class="list-group">
                <!--<h2 class="center">读书</h2>-->     <!--原来aside2上面的大标题-->
                
                  <a href="/2017/01/10/Book-List-2017.html" class="list-group-item-lay pjaxlink">2017年阅读书单</a>
                
                  <a href="/2017/01/09/Book-List-2016.html" class="list-group-item-lay pjaxlink">2016年阅读书单</a>
                
              </div>
            </div>
           
            <div class="tab-pane" id="科研">
              <div class="list-group">
                <!--<h2 class="center">科研</h2>-->     <!--原来aside2上面的大标题-->
                
                  <a href="/2017/07/18/tensorflow-setup.html" class="list-group-item-lay pjaxlink">tensorflow的安装（ubuntu16.04+cuda8.0+cuDNN6）</a>
                
                  <a href="/2017/04/03/set-up-ubuntu.html" class="list-group-item-lay pjaxlink">Ubuntu16.04的双系统安装</a>
                
                  <a href="/2017/01/12/tracking-summary-2.0.html" class="list-group-item-lay pjaxlink">目标跟踪综述2.0</a>
                
                  <a href="/2017/01/11/git-usage.html" class="list-group-item-lay pjaxlink">Git的使用</a>
                
                  <a href="/2017/01/10/study-kcf.html" class="list-group-item-lay pjaxlink">KCF跟踪算法</a>
                
              </div>
            </div>
                
          <div class="tab-pane" id="tags">
            <div class="panel-group" id="accordion">
              <!--<h2 class="center">标签</h2>-->
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#摄影">摄影</a>
                      <span class="badge pull-right">2</span>
                    </h4>
                  </div>
                  <div id="摄影" class="panel-collapse collapse">
                    
                      <a  href='/2017/01/01/go-over-2016.html' class="list-group-item pjaxlink">
                        回顾2016--九张最有意义的照片
                      </a>
                    
                      <a  href='/2016/08/27/wangjingSOHO.html' class="list-group-item pjaxlink">
                        望京SOHO--第一次爬楼
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#爬楼">爬楼</a>
                      <span class="badge pull-right">1</span>
                    </h4>
                  </div>
                  <div id="爬楼" class="panel-collapse collapse">
                    
                      <a  href='/2016/08/27/wangjingSOHO.html' class="list-group-item pjaxlink">
                        望京SOHO--第一次爬楼
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#目标跟踪">目标跟踪</a>
                      <span class="badge pull-right">2</span>
                    </h4>
                  </div>
                  <div id="目标跟踪" class="panel-collapse collapse">
                    
                      <a  href='/2017/01/12/tracking-summary-2.0.html' class="list-group-item pjaxlink">
                        目标跟踪综述2.0
                      </a>
                    
                      <a  href='/2017/01/10/study-kcf.html' class="list-group-item pjaxlink">
                        KCF跟踪算法
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#Git">Git</a>
                      <span class="badge pull-right">1</span>
                    </h4>
                  </div>
                  <div id="Git" class="panel-collapse collapse">
                    
                      <a  href='/2017/01/11/git-usage.html' class="list-group-item pjaxlink">
                        Git的使用
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#Ubuntu">Ubuntu</a>
                      <span class="badge pull-right">1</span>
                    </h4>
                  </div>
                  <div id="Ubuntu" class="panel-collapse collapse">
                    
                      <a  href='/2017/04/03/set-up-ubuntu.html' class="list-group-item pjaxlink">
                        Ubuntu16.04的双系统安装
                      </a>
                    
                  </div>
                </div>
               
                <div class="panel panel-info">
                  <div class="panel-heading">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" data-toggle="collapse" data-parent="#accordion" href="#深度学习">深度学习</a>
                      <span class="badge pull-right">1</span>
                    </h4>
                  </div>
                  <div id="深度学习" class="panel-collapse collapse">
                    
                      <a  href='/2017/07/18/tensorflow-setup.html' class="list-group-item pjaxlink">
                        tensorflow的安装（ubuntu16.04+cuda8.0+cuDNN6）
                      </a>
                    
                  </div>
                </div>
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
      <div class="col-md-13 col-lg-13 col-sm-13 col-xs-13 aside3">
        <div id="container">
          <div id="pjax">
            <div class="row">
  <div class="col-md-13 aside3-title">
    <br>
    <h2 id="#identifier">tensorflow的安装（ubuntu16.04+cuda8.0+cuDNN6）</h2>
    2017年07月18日
  </div>
  <div class="col-md-13 aside3-content">
    <hr>
    <div id="content">
      <h2>感悟</h2>

<ol>
<li><p>遇到问题不要过于着急地去尝试新的方法，应该将整一个步骤看完。  </p></li>
<li><p>学会看错误报告，并且学会在网上找解决方法和不要惧怕英文网站。  </p></li>
</ol>

<h2>整个过程</h2>

<p>实验室要求搭建一个GOOGLE NMT翻译系统，需要用到tensorflow,刚好笔记本有ubuntu16.04和CUDA8.0，所以想都没想就打算安装在LINUX上,也对，但是每次关于环境的配置，总是遇到很多问题，并且走了很多弯路，最后，莫名奇妙地就解决了。
刚开始在<a href="http://www.tensorfly.cn/">tensorflow中文网站</a>找到了解决方法，并且也开始尝试了，但是too young too simple，就用了pip的方法来安装tensorflow，由于是安装已编译的版本，所以如果用GPU的版本，只能用规定的cuda7.5和cudnn5，由于我不想在电脑上配置太多的版本，所以这种方法后来就失败了。经过一系列百度后，得知应该git clone源代码下来自己进行配置编译，这样的话，就能实现cuda8.0+cudnn6了。按照这个方法，虽然中间遇到了一些问题，最后莫名其妙地多尝试了几遍，忽然就成功了。所以把重要的资料记录下来，如果读者或者自己遇到同样的情况，就能找到成功的解决方法了。</p>

<h2>电脑配置</h2>

<p>设备：msi GP62-1071笔记本  </p>

<p>系统：ubuntu16.04  </p>

<p>CPU：i7-6700hq  </p>

<p>显卡：gtx965m  </p>

<p><a href="http://www.tensorfly.cn/tfdoc/get_started/os_setup.html">tensorflow官方安装指南</a>  </p>

<p>不要选择pip的安装方法，选择用源码下载。</p>

<h2>clone源码</h2>
<div class="highlight"><pre><code class="language-" data-lang="">$ git clone --recurse-submodules https://github.com/tensorflow/tensorflow
</code></pre></div>
<h2>bazel安装</h2>

<ul>
<li>安装JAVA环境<br></li>
</ul>
<div class="highlight"><pre><code class="language-" data-lang="">sudo apt-get update
sudo apt-get install default-jre
sudo apt-get install default-jdk
</code></pre></div>
<ul>
<li>添加bazel的源<br></li>
</ul>
<div class="highlight"><pre><code class="language-" data-lang="">$ echo "deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8" | sudo tee /etc/apt/sources.list.d/bazel.list #如果这里你用的是jdk7，要把jdk1.8替换为jdk1.7
$ curl https://storage.googleapis.com/bazel-apt/doc/apt-key.pub.gpg | sudo apt-key add -
</code></pre></div>
<ul>
<li>安装bazel<br></li>
</ul>
<div class="highlight"><pre><code class="language-" data-lang="">$ sudo apt-get update &amp;&amp; sudo apt-get install bazel
</code></pre></div>
<ul>
<li>测试<br>
在terminal中输入bazel来测试是否安装成功。<br></li>
</ul>

<h2>下载其他依赖文件</h2>

<ul>
<li>配置<br></li>
</ul>
<div class="highlight"><pre><code class="language-" data-lang=""># For Python 2.7:
$ sudo apt-get install python-numpy swig python-dev python-wheel
# For Python 3.x:
$ sudo apt-get install python3-numpy swig python3-dev python3-wheel
</code></pre></div>
<h2>编译tensorflow</h2>

<p>cd进入tensorflow的目录，先进行对tensorflow的配置和符号链接  </p>
<div class="highlight"><pre><code class="language-" data-lang="">$ ./configure
Please specify the location of python. [Default is /usr/bin/python]:
Do you wish to build TensorFlow with Google Cloud Platform support? [y/N] N
No Google Cloud Platform support will be enabled for TensorFlow
Do you wish to build TensorFlow with GPU support? [y/N] y
GPU support will be enabled for TensorFlow
Please specify which gcc nvcc should use as the host compiler. [Default is /usr/bin/gcc]:
Please specify the Cuda SDK version you want to use, e.g. 7.0. [Leave empty to use system default]: 7.5
Please specify the location where CUDA 7.5 toolkit is installed. Refer to README.md for more details. [Default is /usr/local/cuda]:
Please specify the cuDNN version you want to use. [Leave empty to use system default]: 5
Please specify the location where cuDNN 5 library is installed. Refer to README.md for more details. [Default is /usr/local/cuda]:
Please specify a list of comma-separated Cuda compute capabilities you want to build with.
You can find the compute capability of your device at: https://developer.nvidia.com/cuda-gpus.
Please note that each additional compute capability significantly increases your build time and binary size.

Setting up Cuda include
Setting up Cuda lib
Setting up Cuda bin
Setting up Cuda nvvm
Setting up CUPTI include
Setting up CUPTI lib64
Configuration finished
</code></pre></div>
<p>注意这里要根据需要选择y和n，如果要用GPU的话，记得正确选择。  </p>

<ul>
<li>编译</li>
</ul>
<div class="highlight"><pre><code class="language-" data-lang="">$ bazel build -c opt --config=cuda //tensorflow/cc:tutorials_example_trainer
$ bazel-bin/tensorflow/cc/tutorials_example_trainer --use_gpu
# Lots of output. This tutorial iteratively calculates the major eigenvalue of
# a 2x2 matrix, on GPU. The last few lines look like this.
000009/000005 lambda = 2.000000 x = [0.894427 -0.447214] y = [1.788854 -0.894427]
000006/000001 lambda = 2.000000 x = [0.894427 -0.447214] y = [1.788854 -0.894427]
000009/000009 lambda = 2.000000 x = [0.894427 -0.447214] y = [1.788854 -0.894427]
</code></pre></div>
<h2>创建pip包并安装</h2>
<div class="highlight"><pre><code class="language-" data-lang="">$ bazel build -c opt //tensorflow/tools/pip_package:build_pip_package

# To build with GPU support:
$ bazel build -c opt --config=cuda //tensorflow/tools/pip_package:build_pip_package

$ bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg

#The name of the .whl file will depend on your platform.
#这一步之前,你要进入/te//tensorflow_pkg目录查看具体生成的whl文件的名称，这不是固定的
$ sudo pip install /tmp/tensorflow_pkg/tensorflow-0.10.0rc0-py2-none-any.whl
</code></pre></div>
<h2>玄学的一步</h2>

<p>做完以上的步骤后，进入Python，依然显示我没有配置tensorflow。<br>
此时灵机一动，进入ipython之后，居然能够成功运行。<br>
更神奇的是，进入python也可以运行。
到这里就已经成功了，如果还出现问题，参考下面的三个链接。</p>

<h2>参考资料</h2>

<p><a href="http://www.tensorfly.cn/tfdoc/get_started/os_setup.html">tensorflow中文官方指南</a><br>
<a href="http://www.52nlp.cn/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%BB%E6%9C%BA%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-ubuntu16-04-geforce-gtx1080-tensorflow">深度学习主机环境配置: Ubuntu16.04+GeForce GTX 1080+TensorFlow</a>
<a href="http://blog.csdn.net/u010900574/article/details/52201808">ubuntu14.04+GTX1080+cuda8.0+cudnn5.1+源码编译tensorflow安装教程</a></p>

    </div>
    <hr>
    <div id="disqus_thread">
  <button type="button" name="yingsen1" class="btn btn-default show-commend">	
  	<i class="fa fa-comment-o fa-lg" style="color: #16a095;"></i>     <!-- 修改显示评论按钮图标-->
  </button>
</div>

  </div>
  <!-- 目录 -->
  <div id="content_table" style="position:fixed;right:20px;top:120px;display:none;">
    <div class="panel panel-success">
      <div class="panel-body" id="nav"></div>
    </div>
  </div>
</div>


          </div>
        </div>
      </div>
    </div>
  </div>
  <div style="position:fixed;right:15px;top:62px;">
  <button id="content_btn" class="btn btn-primary" style="width:43px; height:34px;">
    <i class="fa fa-lg fa-plus"></i>
  </button>
</div>
<div style="position:fixed;right:15px;top:20px;">
  <button id="nav_btn" class="btn btn-primary">
    <i class="fa fa-lg fa-navicon"></i>
  </button>
</div>
<script type="text/javascript" src="/public/js/jquery.js"></script>
<script type="text/javascript" src="/public/js/bootstrap.js"></script>
<script src="/public/js/jquery.pjax.js"></script>
<script src="/public/js/prettify/prettify.js"></script>
<script src="/public/js/base.js"></script>
<!--
<script src="/public/js/jquery.scrollUp.js"></script>
-->
<script>
    $('a[href="#摄影"]').tab('show');
</script>


<!--button是右上方导航和显示目录的按钮-->


  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-90113009-1', 'yingsen1.github.io');
  ga('send', 'pageview');
</script>
</body>
</html>